# Supervisor Configuration for Tournament Arena Backend
# Place this file at: /etc/supervisor/conf.d/tournamentArena.conf

[program:tournament_backend]
# Command to run - using uvicorn for ASGI support (WebSockets)
command=/var/www/tournamentArena/backend/venv/bin/uvicorn backend.asgi:application --host 127.0.0.1 --port 8000 --workers 4

# Working directory
directory=/var/www/tournamentArena/backend

# User to run the process
user=tournament

# Auto start and restart
autostart=true
autorestart=true

# Stop signals
stopsignal=TERM
stopwaitsecs=10

# Logging
redirect_stderr=true
stdout_logfile=/var/log/tournament_backend.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile=/var/log/tournament_backend_error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10

# Environment variables
environment=PATH="/var/www/tournamentArena/backend/venv/bin",DJANGO_SETTINGS_MODULE="backend.settings_production"

# Process priority
priority=999

# Number of seconds to wait for the process to start
startsecs=10

# If true, this program will start automatically when supervisord is started
autostart=true

# May be one of false, unexpected, or true.
autorestart=true

# Exit codes that trigger an restart when autorestart is unexpected
exitcodes=0

# Number of times to try to restart before giving up
startretries=3
